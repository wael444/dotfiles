#!/usr/bin/env -S bash

# icons, colors 
declare -A icons colors
icons=(
	[time]=' ' [music]=' '
	[Hvol]='墳 ' [Dvol]='奔' [Lvol]='奄'[Mvol]='ﱝ '
)
colors=( [time]=4    [audio]=4 )

# helpers
function print() { printf "^C%s^%s^d^%s" "$@" ; }
function notify() { dunstify -r 64219 "$@" ; }

# the brain damaging modules
function time() {
	local curtime="$(date '+%a %H:%M:%S')"
	print ${colors[time]} "${icons[time]}" "${curtime,,}"

	[ -z $BLOCK_BUTTON ] || {
		local cal="$(cal)" && local cal="${cal%$'\n'*}"
		local head="${cal%%$'\n'*}"
		local body="${cal/$head$'\n'/}"
		local curday="$(date +%d)"
		notify "$head" "${body/$curday/<b>$curday</b>}"
	}
}

function audio() {
	local vol=$(volctl getvol)
	print ${colors[audio]} "${icons[Hvol]}" ${vol}%
	case $BLOCK_BUTTON in
		1) pavucontrol ;;
		3) volctl mute ;;
		5) volctl -5%  ;;
		4) volctl +5%  ;;
	esac
}

$1
